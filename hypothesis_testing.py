from scipy import stats
import pandas as pd
bikeSharing = {'Standard-GBT': {'CMSE': [4066.358161, 7195.057611, 6683.00963, 7500.528475],
                        'MSE': [2856.710533, 2992.966803, 2963.805199, 3038.368157],
                        'CER': [0.5375, 0.647058824, 0.567567568, 0.653333333]},
                'Constant-Weight': {'CMSE': [478.3343115, 602.5444101, 1033.569041, 1036.657539],
                                 'MSE': [4255.466618, 3707.532542, 4001.120902, 4405.928121],
                                 'CER': [0.23125, 0.331550802, 0.27027027, 0.286666667]},
                'Smart-Weight': {'CMSE': [4066.358161, 7195.057611, 6683.00963, 7500.528475],
                                       'MSE': [2856.710533, 2992.966803, 2963.805199, 3038.368157],
                                       'CER': [0.5375, 0.647058824, 0.567567568, 0.653333333]},
                'Dynamic-Weight': {'CMSE': [161.5335308, 175.3351952, 760.9524359, 363.9015732],
                                   'MSE': [10785.36251, 10024.97424, 10553.59987, 9937.261895],
                                   'CER': [0.15625, 0.187165775, 0.2, 0.12]},
                'Constraint-Loss': {'CMSE': [3688.047346, 6583.573915, 6430.912757, 7432.348906],
                                   'MSE': [2828.228609, 2939.356692, 2949.088925, 3054.931867],
                                   'CER': [0.51875, 0.64171123, 0.562162162, 0.606666667]}
                }

news = {'Standard-GBT': {'CMSE': [1959104960, 2073757390, 1837734489, 2184750537, 1901079848],
                        'MSE': [140742234.4, 153149824.6, 147239419.5, 156705270.8, 131741321.5],
                        'CER': [0.992788462, 0.992665037, 0.994520548, 0.994987469, 0.99513382]},
                'Constant-Weight': {'CMSE': [1706769311, 1806221955, 1560712152, 1955260925, 1623255088],
                                 'MSE': [195646301.2, 202520562.2, 195710203.3, 214184468.4, 183568380.5],
                                 'CER': [0.901442308, 0.894865526, 0.876712329, 0.897243108, 0.909975669]},
                'Smart-Weight': {'CMSE': [1959104960, 2073757390, 1837734489, 2184750537, 1901079848],
                                       'MSE': [140742234.4, 153149824.6, 147239419.5, 156705270.8, 131741321.5],
                                       'CER': [0.992788462, 0.992665037, 0.994520548, 0.994987469, 0.99513382]},
                'Dynamic-Weight': {'CMSE': [1606761618, 1688633580, 1433607006, 1818743786, 1438019323],
                                   'MSE': [730811383.8, 749835599.7, 790446644.9, 772751724.4, 720187491.7],
                                   'CER': [0.944711538, 0.941320293, 0.936986301, 0.909774436, 0.914841849]},
                'Constraint-Loss': {'CMSE': [1958843680, 2074110235, 1837520950, 2184857983, 1906939048],
                                   'MSE': [141628674.5, 156642123.8, 144037226.7, 156016403.6, 132315509.9],
                                   'CER': [0.990384615, 0.992665037, 0.994520548, 0.994987469, 0.99513382]}
                }

compactiv = {'Standard-GBT': {'CMSE': [0.813278267, 0.719762349, 0.731432875, 0.659270811, 0.631106914],
                        'MSE': [9.105684596, 6.311852206, 6.296710387, 6.359962209, 6.075075038],
                        'CER': [0.559139785, 0.536585366, 0.510324484, 0.483870968, 0.473498233]},
                'Constant-Weight': {'CMSE': [0.207840567, 0.268404562, 0.253272044, 0.135129789, 0.172639754],
                                 'MSE': [9.506991471, 6.939656779, 6.985240727, 7.022927701, 6.795661802],
                                 'CER': [0.282258065, 0.283536585, 0.333333333, 0.284457478, 0.229681979]},
                'Smart-Weight': {'CMSE': [0.549690318, 0.508921677, 0.506183832, 0.403572715, 0.406868529],
                                       'MSE': [9.273438304, 6.41536266, 6.436949763, 6.460716065, 6.182994174],
                                       'CER': [0.438172043, 0.432926829, 0.415929204, 0.407624633, 0.399293286]},
                'Dynamic-Weight': {'CMSE': [0.184504401, 0.100162593, 0.123987312, 0.069653652, 0.062839694],
                                   'MSE': [11.54347885, 8.574711455, 8.568488344, 8.325442393, 8.761997419],
                                   'CER': [0.26344086, 0.286585366, 0.289085546, 0.26686217, 0.261484099]},
                'Constraint-Loss': {'CMSE': [0.383416658, 0.335964855, 0.395406171, 0.278979888, 0.298379555],
                                   'MSE': [9.469523727, 6.653216905, 6.668913933, 6.566042924, 6.294292189],
                                   'CER': [0.360215054, 0.344512195, 0.333333333, 0.287390029, 0.307420495]}
             }

CTSlices = {'Standard-GBT': {'CMSE': [136.6042685, 140.2037644, 133.99269, 123.4937498, 126.3580215],
                        'MSE': [76.8427843, 76.22328732, 77.04361989, 76.61525464, 77.06943579],
                        'CER': [0.919708029, 0.915879017, 0.915958451, 0.903591682, 0.912882298]},
                'Constant-Weight': {'CMSE': [6.840775245, 6.145562139, 7.46547555, 5.974266412, 5.710406001],
                                 'MSE': [80.34840044, 80.15309898, 81.26089421, 83.70898967, 80.68826229],
                                 'CER': [0.362226277, 0.347826087, 0.361661945, 0.328922495, 0.3197405]},
                'Smart-Weight': {'CMSE': [67.1429425, 67.86003219, 64.9711391, 61.51574824, 62.386802],
                                       'MSE': [70.74160399, 70.11284348, 71.56112325, 72.58543288, 72.61015978],
                                       'CER': [0.705291971, 0.707939509, 0.702549575, 0.694706994, 0.701575533]},
                'Dynamic-Weight': {'CMSE': [3.83347102036, 3.54982624590625, 3.77672554487621, 3.65635881300426, 3.31168611306527],
                                   'MSE': [114.976110855917, 110.039318771273, 107.427894084811, 114.223796455932, 109.398351119699],
                                   'CER': [0.324817518248175, 0.318525519848771, 0.319169027384324, 0.322306238185255, 0.302131603336422]},
                'Constraint-Loss': {'CMSE': [3.427240984, 6.192018912, 2.862971791, 2.590185706, 4.784004841],
                                   'MSE': [83.1422055, 84.23882447, 81.73599403, 87.99716593, 85.50775451],
                                   'CER': [0.175182482, 0.246691871, 0.21529745, 0.188090737, 0.21223355]}
            }

Industry = {'Standard-GBT': {'CMSE': [361.044980929558, 401.711481179938, 618.392787784662, 403.115081072277, 429.658217171804],
                        'MSE': [116.037829952524, 116.748738195303, 147.594455966033, 122.904027876434, 112.054431365659],
                        'CER': [0.735294117647058, 0.712, 0.783783783783783, 0.762845849802371, 0.68076923076923]},
                'Constant-Weight': {'CMSE': [224.143697199742, 188.155053469061, 396.473543576507, 228.137125652678, 249.772812749419],
                                 'MSE': [255.967569736837, 243.555222709249, 285.905236975951, 262.817575707324, 238.58554534114],
                                 'CER': [0.605042016806722, 0.604, 0.594594594594594, 0.620553359683794, 0.519230769230769]},
                'Smart-Weight': {'CMSE': [327.149301248635, 329.078246765893, 521.354956542359, 302.603570272669, 371.991972331099],
                                       'MSE': [121.853268510408, 123.422119935328, 153.643638834644, 128.706224750813, 118.210303521963],
                                       'CER': [0.680672268907563, 0.688, 0.694980694980695, 0.703557312252964, 0.603846153846153]},
                'Dynamic-Weight': {'CMSE': [247.030427524957, 254.43959358504, 433.460855389493, 227.674822158047, 269.803674997532],
                                   'MSE': [123.513779767981, 125.666767901017, 152.303148837182, 127.909396760354, 115.059316461867],
                                   'CER': [0.57563025210084, 0.624, 0.598455598455598, 0.636363636363636, 0.553846153846153]},
                'Constraint-Loss': {'CMSE': [281.358437309391, 281.665296324505, 371.45038114996, 238.857829899058, 267.243330567572],
                                   'MSE': [123.082677204, 122.664441985846, 146.637308015888, 124.915536849901, 115.8227420904],
                                   'CER': [0.554621848739495, 0.612, 0.598455598455598, 0.58498023715415, 0.542307692307692]}
       }

KCHouses = {'Standard-GBT': {'CMSE': [23529993271.3089, 49995002659.2952, 42439729603.1906, 29370278690.024, 44477587907.5961],
                        'MSE': [10977738166.1532, 16854203167.8441, 15545784319.1151, 12075914091.6891, 15673627121.1796],
                        'CER': [0.647714604236343, 0.624137931034482, 0.621247113163972, 0.624121779859484, 0.654306220095693]},
                'Constant-Weight': {'CMSE': [22004554936.848, 47364530765.294, 42700652150.4264, 26918670464.9604, 43484284805.9494],
                                 'MSE': [10763676214.3673, 16697108038.9241, 15972902268.0868, 11818272834.3774, 15808707293.2001],
                                 'CER': [0.630992196209587, 0.610344827586206, 0.594688221709006, 0.610070257611241, 0.644736842105263]},
                'Smart-Weight': {'CMSE': [23529993271.3089, 49995002659.2952, 42439729603.1906, 29370278690.024, 44477587907.5961],
                                       'MSE': [10977738166.1532, 16854203167.8441, 15545784319.1151, 12075914091.6891, 15673627121.1796],
                                       'CER': [0.647714604236343, 0.624137931034482, 0.621247113163972, 0.624121779859484, 0.654306220095693]},
                'Dynamic-Weight': {'CMSE': [14283490008.639, 39282975895.6306, 34749115476.9568, 18225644690.0458, 39530643763.0787],
                                   'MSE': [19551527656.2461, 25860667045.3642, 25731789991.1212, 20522994547.0975, 25693644227.5399],
                                   'CER': [0.425863991081382, 0.405747126436781, 0.408775981524249, 0.391100702576112, 0.406698564593301]},
                'Constraint-Loss': {'CMSE': [23692259840.1794, 50921639144.0234, 43528271911.7054, 29197178181.4117, 43654927147.0077],
                                      'MSE': [10957338635.7433, 17166398548.199, 15939456046.6762, 12071340548.2353, 15547203754.2346],
                                      'CER': [0.643255295429208, 0.624137931034482, 0.621247113163972, 0.631147540983606, 0.666267942583732]}
             }

parkinson = {'Standard-GBT': {'CMSE': [6.76864109678203, 6.99931066124851, 6.43905539008908, 4.82645355387902, 8.51815967418385],
                        'MSE': [4.3268444370511, 4.8639868803469, 4.51761824005336, 3.65195056761914, 4.91727289956578],
                        'CER': [0.869565217391304, 0.847161572052401, 0.836653386454183, 0.879828326180257, 0.881355932203389]},
                'Constant-Weight': {'CMSE': [0.522833599749667, 0.316183058461303, 0.661267550497181, 0.25400829191829, 0.265914890984311],
                                 'MSE': [55.4999265764415, 63.3694265309676, 46.0025911612136, 66.1767567828444, 52.3463731361859],
                                 'CER': [0.57391304347826, 0.585152838427947, 0.577689243027888, 0.553648068669527, 0.627118644067796]},
                'Smart-Weight': {'CMSE': [1.0336722172603, 1.36240849408814, 1.29458821073637, 0.80517817786562, 1.30290778280485],
                                       'MSE': [6.78800786164561, 7.55399508018191, 6.18786595006579, 7.00049188261473, 6.6799463300678],
                                       'CER': [0.778260869565217, 0.799126637554585, 0.784860557768924, 0.781115879828326, 0.792372881355932]},
                'Dynamic-Weight': {'CMSE': [0.31381688140014, 0.521444562341672, 0.402350434241801, 0.271621703931172, 0.347891560684583],
                                   'MSE': [22.879570753452, 21.9563306156416, 19.6366646220906, 17.3797832721669, 22.8578044171297],
                                   'CER': [0.695652173913043, 0.772925764192139, 0.669322709163346, 0.575107296137339, 0.766949152542372]},
                'Constraint-Loss': {'CMSE': [1.06949696647529, 1.55109064309451, 1.15206086542011, 0.679098155534616, 1.88972541839466],
                                      'MSE': [3.47605404223413, 3.76044027544177, 3.60987532156819, 3.27276972568644, 3.66321622659024],
                                      'CER': [0.469565217391304, 0.497816593886462, 0.553784860557768, 0.506437768240343, 0.639830508474576]}
             }


flights = {'Standard-GBT': {'CMSE': [58528.9874912029, 102462.314083982, 124114.439348383, 75830.9619430507, 93094.8392273717],
                        'MSE': [40190.8675830251, 37906.6223220599, 35161.7355522832, 33893.7958054474, 37631.8259291574],
                        'CER': [0.716044632550981, 0.706094627105052, 0.696676970633693, 0.691692073170731, 0.68681526256139]},
                'Constant-Weight': {'CMSE': [41826.5531216606, 75170.0809642125, 112407.590673964, 55522.6166486304, 35667.6951115599],
                                 'MSE': [57365.8282204529, 57964.0396871352, 52987.320053369, 59067.9757976375, 56359.7400411341],
                                 'CER': [0.418622547133512, 0.39374498797113, 0.397990726429675, 0.402057926829268, 0.372874952776728]},
                'Smart-Weight': {'CMSE': [56705.6406485915, 86027.0446978321, 113659.874435246, 83686.2972737195, 69819.6645006389],
                                       'MSE': [37488.0274329279, 35985.5575505107, 36628.6584107579, 35401.3559749674, 36769.1857129867],
                                       'CER': [0.699499807618314, 0.70449077786688, 0.729134466769706, 0.723704268292683, 0.704571212693615]},
                'dynamic_weight': {'CMSE': [59384.5601899648, 89547.8714062923, 119079.059136775, 96752.2055969481, 78752.3718264071],
                                   'MSE': [53543.8906100565, 53571.6509087345, 54450.7563016282, 52170.9380321718, 55508.8484052072],
                                   'CER': [0.38283955367449, 0.383720930232558, 0.394899536321483, 0.383003048780487, 0.381941820929353]},
                'Constraint-Loss': {'CMSE': [98098.6048034444, 149387.936367482, 198310.906030555, 108440.229918611, 155392.120606215],
                                   'MSE': [99319.4489249355, 95626.4525288726, 101397.907454111, 101034.387490549, 97905.8040903445],
                                   'CER': [0.684109272797229, 0.671611868484362, 0.673106646058732, 0.677591463414634, 0.67812618058179]}
           }

# comparing dynamic weight to others
results_df = pd.DataFrame(columns=['Dataset', 'ModelA', 'ModelB', 'Measure', 'p-value'])
stats_measure = stats.f_oneway #stats.kruskal
datasets = [bikeSharing, news, compactiv, CTSlices, Industry, KCHouses, parkinson]
datasets_names = ['bikeSharing', 'news', 'compactiv', 'CTSlices', 'Industry', 'KCHouses', 'parkinson']
for idx, cur_dataset in enumerate(datasets):
    for cur_measure in bikeSharing['Dynamic-Weight'].keys():
        # adding the dynamic weight comparison to others
        results_df = results_df.append(pd.Series({'Dataset': datasets_names[idx], 'ModelA': 'GBT', 'ModelB': 'Dynamic-Weight', 'Measure': cur_measure,
                                                  'p-value': stats_measure(cur_dataset['Standard-GBT'][cur_measure],
                                                                           cur_dataset['Dynamic-Weight'][cur_measure])[1]}),
                                       ignore_index=True)

        results_df = results_df.append(pd.Series({'Dataset': datasets_names[idx], 'ModelA': 'Constant-Weight', 'ModelB': 'Dynamic-Weight', 'Measure': cur_measure,
                                                  'p-value': stats_measure(cur_dataset['Constant-Weight'][cur_measure],
                                                                           cur_dataset['Dynamic-Weight'][cur_measure])[1]}),
                                       ignore_index=True)

        results_df = results_df.append(pd.Series({'Dataset': datasets_names[idx], 'ModelA': 'Smart-Weight', 'ModelB': 'Dynamic-Weight', 'Measure': cur_measure,
                                                  'p-value': stats_measure(cur_dataset['Smart-Weight'][cur_measure],
                                                                           cur_dataset['Dynamic-Weight'][cur_measure])[1]}),
                                       ignore_index=True)
        # adding the Constraint-Loss comparison to others
        results_df = results_df.append(pd.Series({'Dataset': datasets_names[idx], 'ModelA': 'Standard-GBT', 'ModelB': 'Constraint-Loss', 'Measure': cur_measure,
                                                  'p-value': stats_measure(cur_dataset['Standard-GBT'][cur_measure],
                                                                           cur_dataset['Constraint-Loss'][cur_measure])[1]}),
                                       ignore_index=True)


        results_df = results_df.append(
            pd.Series({'Dataset': datasets_names[idx], 'ModelA': 'Constant-Weight', 'ModelB': 'Constraint-Loss', 'Measure': cur_measure,
                       'p-value': stats_measure(cur_dataset['Constant-Weight'][cur_measure],
                                                cur_dataset['Constraint-Loss'][cur_measure])[1]}),
            ignore_index=True)

        results_df = results_df.append(
            pd.Series({'Dataset': datasets_names[idx], 'ModelA': 'Smart-Weight', 'ModelB': 'Constraint-Loss', 'Measure': cur_measure,
                       'p-value': stats_measure(cur_dataset['Smart-Weight'][cur_measure],
                                                cur_dataset['Constraint-Loss'][cur_measure])[1]}),
            ignore_index=True)

# filtering only those above 5% and ordering the results
results_df = results_df[results_df['p-value'] <= 0.05]
results_df = results_df.sort_values(by=['Dataset', 'ModelB', 'p-value'])
results_df.to_csv("hypothesis_testing.csv", index=False)
